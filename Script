-- Recorder Stable for Delta Android

if game.CoreGui:FindFirstChild("RecorderUI") then
    game.CoreGui.RecorderUI:Destroy()
end

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local recording = false
local startTime = 0
local records = {}

-- UI
local gui = Instance.new("ScreenGui")
gui.Name = "RecorderUI"
gui.Parent = game.CoreGui

local main = Instance.new("Frame")
main.Parent = gui
main.Size = UDim2.new(0, 320, 0, 180)
main.Position = UDim2.new(0, 50, 0, 100)
main.BackgroundColor3 = Color3.fromRGB(50,50,50)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true

local top = Instance.new("Frame", main)
top.Size = UDim2.new(1,0,0,30)
top.BackgroundColor3 = Color3.fromRGB(70,70,70)

local title = Instance.new("TextLabel", top)
title.Size = UDim2.new(1,0,1,0)
title.Text = "Recorder"
title.TextColor3 = Color3.new(1,1,1)
title.BackgroundTransparency = 1
title.TextSize = 16

local function mkBtn(txt, x)
    local b = Instance.new("TextButton", main)
    b.Size = UDim2.new(0, 90, 0, 30)
    b.Position = UDim2.new(0, x, 0, 50)
    b.Text = txt
    b.TextSize = 14
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(90,90,90)
    b.BorderSizePixel = 0
    return b
end

local recordBtn = mkBtn("Record", 10)
local stopBtn = mkBtn("Stop", 110)
local copyBtn = mkBtn("Copy", 210)

-- Recorder API
local Recorder = {}

function Recorder:Fire(remote, ...)
    if recording then
        table.insert(records,{
            time = tick() - startTime,
            remote = remote,
            args = {...}
        })
    end
    remote:FireServer(...)
end

getgenv().Recorder = Recorder

-- Buttons logic
recordBtn.MouseButton1Click:Connect(function()
    records = {}
    startTime = tick()
    recording = true
    recordBtn.Text = "Recording..."
end)

stopBtn.MouseButton1Click:Connect(function()
    recording = false
    recordBtn.Text = "Record"
end)

copyBtn.MouseButton1Click:Connect(function()
    if recording then return end

    local out = {}
    table.insert(out,"-- Replay Script")
    table.insert(out,"local t0 = tick()")

    for _,v in ipairs(records) do
        local args = {}
        for _,a in ipairs(v.args) do
            if typeof(a) == "string" then
                table.insert(args,string.format("%q",a))
            else
                table.insert(args,tostring(a))
            end
        end

        table.insert(out,
            string.format(
                "task.delay(%.3f,function() %s:FireServer(%s) end)",
                v.time,
                v.remote:GetFullName(),
                table.concat(args,",")
            )
        )
    end

    if setclipboard then
        setclipboard(table.concat(out,"\n"))
    end
end)
